# This file defines what AWS resources and policies a developer
# can create or use in their serverless project.

resources:
  EC2:
    - Type: "AWS::EC2::SecurityGroup"
  RDS:
    - Type: "AWS::RDS::DBInstance"
    - Type: "AWS::RDS::DBSubnetGroup"
  DynamoDB:
    - Type: "AWS::DynamoDB::Table"
  ApiGateway:
    - Type: "AWS::ApiGateway::Account"
    - Type: "AWS::ApiGateway::ApiKey"
    - Type: "AWS::ApiGateway::Authorizer"
    - Type: "AWS::ApiGateway::BasePathMapping"
    - Type: "AWS::ApiGateway::ClientCertificate"
    - Type: "AWS::ApiGateway::Deployment"
    - Type: "AWS::ApiGateway::DocumentationPart"
    - Type: "AWS::ApiGateway::DocumentationVersion"
    - Type: "AWS::ApiGateway::DomainName"
    - Type: "AWS::ApiGateway::GatewayResponse"
    - Type: "AWS::ApiGateway::Method"
    - Type: "AWS::ApiGateway::Model"
    - Type: "AWS::ApiGateway::RequestValidator"
    - Type: "AWS::ApiGateway::Resource"
    - Type: "AWS::ApiGateway::RestApi"
    - Type: "AWS::ApiGateway::Stage"
    - Type: "AWS::ApiGateway::UsagePlan"
    - Type: "AWS::ApiGateway::UsagePlanKey"
    - Type: "AWS::ApiGateway::VpcLink"
    - Type: "AWS::ApiGatewayV2::Integration"
    - Type: "AWS::ApiGatewayV2::Stage"
    - Type: "AWS::ApiGatewayV2::Authorizer"
    - Type: "AWS::ApiGatewayV2::Route"
    - Type: "AWS::ApiGatewayV2::Api"
  LambdaFunction:
    - Type: "AWS::Lambda::EventSourceMapping"
    - Type: "AWS::Lambda::Function"
    - Type: "AWS::Lambda::Alias"
    - Type: "AWS::Lambda::LayerVersion"
    - Type: "AWS::Lambda::LayerVersionPermission"
    - Type: "AWS::Lambda::Permission"
    - Type: "AWS::Lambda::Version"
  S3:
    - Type: "AWS::S3::Bucket"
    - Type: "AWS::S3::BucketPolicy"
    - Type: "Custom::S3" # To support custom cloudformation resources
  CloudFront:
    - Type: "AWS::CloudFront::Distribution"
    - Type: "AWS::CloudFront::CloudFrontOriginAccessIdentity"
    - Type: "AWS::CloudFront::StreamingDistribution"
  SQS:
    - Type: "AWS::SQS::Queue"
    - Type: "AWS::SQS::QueuePolicy"
  SNS:
    - Type: "AWS::SNS::Topic"
  StepFunctions:
    - Type: "AWS::StepFunctions::StateMachine"
  ElastiCache:
    - Type: "AWS::ElastiCache::CacheCluster"
    - Type: "AWS::ElastiCache::ParameterGroup"
    - Type: "AWS::ElastiCache::ReplicationGroup"
    - Type: "AWS::ElastiCache::SecurityGroup"
    - Type: "AWS::ElastiCache::SecurityGroupIngress"
    - Type: "AWS::ElastiCache::SubnetGroup"
  DAX:
    - Type: "AWS::DAX::Cluster"
    - Type: "AWS::DAX::SubnetGroup"
    - Type: "AWS::DAX::ParameterGroup"
  Kinesis:
    - Type: "AWS::Kinesis::Stream"
    - Type: "AWS::Kinesis::StreamConsumer"
    - Type: "AWS::KinesisFirehose::DeliveryStream"
    - Type: "AWS::KinesisAnalytics::Application"
    - Type: "AWS::KinesisAnalytics::ApplicationOutput"
    - Type: "AWS::KinesisAnalytics::ApplicationReferenceDataSource"
  IAM:
    - Type: "AWS::IAM::AccessKey"
    - Type: "AWS::IAM::Group"
    - Type: "AWS::IAM::InstanceProfile"
    - Type: "AWS::IAM::Group"
    - Type: "AWS::IAM::Policy"
    - Type: "AWS::IAM::Role"
    - Type: "AWS::IAM::ServiceLinkedRole"
    - Type: "AWS::IAM::User"
    - Type: "AWS::IAM::UserToGroupAddition"
  CloudWatch:
    - Type: "AWS::CloudWatch::Alarm"
    - Type: "AWS::CloudWatch::Dashboard"
    - Type: "AWS::Events::Rule"
    - Type: "AWS::Events::EventBusPolicy"
    - Type: "AWS::Logs::Destination"
    - Type: "AWS::Logs::LogGroup"
    - Type: "AWS::Logs::LogStream"
    - Type: "AWS::Logs::MetricFilter"
    - Type: "AWS::Logs::SubscriptionFilter"

events:
  schedule:
  stream:
    - type: kinesis
    - type: dynamodb
  sqs:
  s3:
  http:

actionsWithWildcardResource:
  cloudwatch:
    - PutMetricData
    - PutMetricAlarm

actions:
  secretsmanager:
    - GetSecretValue
  kms:
    - Decrypt
    - DescribeKey
  cloudwatch:
    - PutMetricData
    - PutMetricAlarm
  events:
    - PutEvents 
  dynamodb:
    - BatchGetItem
    - BatchWriteItem
    - ConditionCheck
    - CreateBackup
    - CreateGlobalTable
    - ConditionCheckItem
    - DeleteBackup
    - DeleteItem
    - DescribeBackup
    - DescribeContinuousBackups
    - DescribeContributorInsights
    - DescribeEndpoints
    - DescribeGlobalTable
    - DescribeGlobalTableSettings
    - DescribeLimits
    - DescribeReservedCapacity
    - DescribeReservedCapacityOfferings
    - DescribeStream
    - DescribeTable
    - DescribeTableReplicaAutoScaling
    - DescribeTimeToLive
    - EnclosingOperation
    - GetItem
    - GetRecords
    - GetShardIterator
    - ListBackups
    - ListContributorInsights
    - ListGlobalTables
    - ListStreams
    - ListTables
    - ListTagsOfResource
    - PutItem
    - Query
    - RestoreTableFromBackup
    - RestoreTableToPointInTime
    - Scan
    - UpdateContinuousBackups
    - UpdateGlobalTable
    - UpdateGlobalTableSettings
    - TransactGetItems
    - TransactWriteItems
    - UpdateItem
    - UpdateTimeToLive
  dax:
    - GetItem
    - BatchGetItem
    - Query
    - Scan
    - PutItem
    - UpdateItem
    - DeleteItem
    - BatchWriteItem
    - DefineKeySchema
    - DefineAttributeList
    - DefineAttributeListId
    - Endpoints
    - ConditionCheckItem
  kinesis:
    - AddTagsToStream
    - CreateStream
    - DecreaseStreamRetentionPeriod
    - DeleteStream
    - DescribeLimits
    - DescribeStream
    - DescribeStreamSummary
    - DisableEnhancedMonitoring
    - EnableEnhancedMonitoring
    - GetRecords
    - GetShardIterator
    - ListShards
    - ListStreamConsumers
    - ListStreams
    - ListTagsForStream
    - MergeShards
    - PutRecord
    - PutRecords
    - RemoveTagsFromStream
    - SplitShard
    - SubscribeToShard
    - UpdateShardCount
    - DeregisterStreamConsumer
    - DescribeStreamConsumer
    - RegisterStreamConsumer
  s3:
    - AbortMultipartUpload
    - CompleteMultipartUpload
    - CopyObject
    - CreateMultipartUpload
    - DeleteBucketCors
    - DeleteBucketPolicy
    - DeleteBucketTagging
    - DeleteObject
    - DeleteObjects
    - DeleteObjectTagging
    - GetBucketAccelerateConfiguration
    - GetBucketAcl
    - GetBucketCORS
    - GetBucketAnalyticsConfiguration
    - GetBucketCors
    - GetBucketEncryption
    - GetBucketInventoryConfiguration
    - GetBucketLifecycle
    - GetBucketLifecycleConfiguration
    - GetBucketLocation
    - GetBucketLogging
    - GetBucketMetricsConfiguration
    - GetBucketNotification
    - GetBucketNotificationConfiguration
    - GetBucketPolicy
    - GetBucketPolicyStatus
    - GetBucketReplication
    - GetBucketRequestPayment
    - GetBucketTagging
    - GetObjectVersion
    - GetObjectVersionAcl
    - GetObjectVersionForReplication
    - GetObjectVersionTagging
    - GetObjectVersionTorrent
    - GetReplicationConfiguration
    - ListAllMyBuckets
    - ListBucket
    - ListBucketByTags
    - ListBucketMultipartUploads
    - ListBucketVersions
    - ListMultipartUploadParts
    - GetBucketVersioning
    - GetBucketWebsite
    - GetObject
    - GetObjectAcl
    - GetObjectLegalHold
    - GetObjectLockConfiguration
    - GetObjectRetention
    - GetObjectTagging
    - GetObjectTorrent
    - GetPublicAccessBlock
    - HeadBucket
    - HeadObject
    - ListBucketAnalyticsConfigurations
    - ListBucketInventoryConfigurations
    - ListBucketMetricsConfigurations
    - ListBuckets
    - ListMultipartUploads
    - ListObjects
    - ListObjectsV2
    - ListObjectVersions
    - ListParts
    - PutBucketAcl
    - PutBucketCors
    - PutBucketPolicy
    - PutBucketTagging
    - PutObject
    - PutObjectAcl
    - PutObjectLegalHold
    - PutObjectLockConfiguration
    - PutObjectRetention
    - PutObjectTagging
    - RestoreObject
    - SelectObjectContent
    - UploadPart
    - UploadPartCopy
  logs:
    - AssociateKmsKey
    - CancelExportTask
    - CreateExportTask
    - CreateLogDelivery
    - CreateLogGroup
    - CreateLogStream
    - DeleteDestination
    - DeleteLogDelivery
    - DeleteLogGroup
    - DeleteLogStream
    - DeleteMetricFilter
    - DeleteResourcePolicy
    - DeleteRetentionPolicy
    - DeleteSubscriptionFilter
    - DescribeDestinations
    - DescribeExportTasks
    - DescribeLogGroups
    - DescribeLogStreams
    - DescribeMetricFilters
    - DescribeQueries
    - DescribeResourcePolicies
    - DescribeSubscriptionFilters
    - DisassociateKmsKey
    - FilterLogEvents
    - GetLogDelivery
    - GetLogEvents
    - GetLogGroupFields
    - GetLogRecord
    - GetQueryResults
    - ListLogDeliveries
    - ListTagsLogGroup
    - PutDestination
    - PutDestinationPolicy
    - PutLogEvents
    - PutMetricFilter
    - PutResourcePolicy
    - PutRetentionPolicy
    - PutSubscriptionFilter
    - StartQuery
    - StopQuery
    - TagLogGroup
    - TestMetricFilter
    - UntagLogGroup
    - UpdateLogDelivery
  sqs:
    - AddPermission
    - ChangeMessageVisibility
    - ChangeMessageVisibilityBatch
    - CreateQueue
    - DeleteMessage
    - DeleteMessageBatch
    - DeleteQueue
    - GetQueueAttributes
    - GetQueueUrl
    - ListDeadLetterSourceQueues
    - ListQueueTags
    - ListQueues
    - PurgeQueue
    - ReceiveMessage
    - RemovePermission
    - SendMessage
    - SendMessageBatch
    - SetQueueAttributes
    - TagQueue
    - UntagQueue
  sns:
    - Publish
    - Subscribe
    - Unsubscribe
    - ListSubscriptions
    - ListSubscriptionsByTopic
    - GetTopicAttributes
    - GetSubscriptionAttributes
  lambda:
    - AddLayerVersionPermission
    - AddPermission
    - CreateAlias
    - CreateEventSourceMapping
    - CreateFunction
    - DeleteAlias
    - DeleteEventSourceMapping
    - DeleteFunction
    - DeleteFunctionConcurrency
    - DeleteLayerVersion
    - EnableReplication
    - GetAccountSettings
    - GetAlias
    - GetEventSourceMapping
    - GetFunction
    - GetFunctionConfiguration
    - GetLayerVersion
    - GetLayerVersionPolicy
    - GetPolicy
    - InvokeAsync
    - InvokeFunction
    - ListAliases
    - ListEventSourceMappings
    - ListFunctions
    - ListLayerVersions
    - ListLayers
    - ListTags
    - ListVersionsByFunction
    - PublishLayerVersion
    - PublishVersion
    - PutFunctionConcurrency
    - RemoveLayerVersionPermission
    - RemovePermission
    - TagResource
    - UntagResource
    - UpdateAlias
    - UpdateEventSourceMapping
    - UpdateFunctionCode
    - UpdateFunctionConfiguration
  iam:
    - GenerateCredentialReport
    - GenerateServiceLastAccessedDetails
    - GetAccessKeyLastUsed
    - GetAccountAuthorizationDetails
    - GetAccountPasswordPolicy
    - GetAccountSummary
    - GetContextKeysForCustomPolicy
    - GetContextKeysForPrincipalPolicy
    - GetCredentialReport
    - GetGroup
    - GetGroupPolicy
    - GetInstanceProfile
    - GetLoginProfile
    - GetOpenIDConnectProvider
    - GetPolicy
    - GetPolicyVersion
    - GetRole
    - GetRolePolicy
    - GetSAMLProvider
    - GetSSHPublicKey
    - GetServerCertificate
    - GetServiceLastAccessedDetails
    - GetServiceLastAccessedDetailsWithEntities
    - GetServiceLinkedRoleDeletionStatus
    - GetUser
    - GetUserPolicy
    - ListAccessKeys
    - ListAccountAliases
    - ListAttachedGroupPolicies
    - ListAttachedRolePolicies
    - ListAttachedUserPolicies
    - ListEntitiesForPolicy
    - ListGroupPolicies
    - ListGroups
    - ListGroupsForUser
    - ListInstanceProfiles
    - ListInstanceProfilesForRole
    - ListMFADevices
    - ListOpenIDConnectProviders
    - ListPolicies
    - ListPoliciesGrantingServiceAccess
    - ListPolicyVersions
    - ListRolePolicies
    - ListRoleTags
    - ListRoles
    - ListSAMLProviders
    - ListSSHPublicKeys
    - ListServerCertificates
    - ListServiceSpecificCredentials
    - ListSigningCertificates
    - ListUserPolicies
    - ListUserTags
    - ListUsers
    - ListVirtualMFADevices
  ssm:
    - AddTagsToResource
    - DeleteParameter
    - GetParametersByPath
    - GetParameters
    - GetParameter
    - GetParameterHistory
    - PutParameter
    - DescribeParameters
  ec2:
    - DescribeAccountAttributes
    - DescribeAddresses
    - DescribeAggregateIdFormat
    - DescribeAvailabilityZones
    - DescribeBundleTasks
    - DescribeByoipCidrs
    - DescribeCapacityReservations
    - DescribeClassicLinkInstances
    - DescribeConversionTasks
    - DescribeCustomerGateways
    - DescribeDhcpOptions
    - DescribeEgressOnlyInternetGateways
    - DescribeElasticGpus
    - DescribeExportTasks
    - DescribeFleetHistory
    - DescribeFleetInstances
    - DescribeFleets
    - DescribeFlowLogs
    - DescribeFpgaImageAttribute
    - DescribeFpgaImages
    - DescribeHostReservationOfferings
    - DescribeHostReservations
    - DescribeHosts
    - DescribeIamInstanceProfileAssociations
    - DescribeIdFormat
    - DescribeIdentityIdFormat
    - DescribeImageAttribute
    - DescribeImages
    - DescribeImportImageTasks
    - DescribeImportSnapshotTasks
    - DescribeInstanceAttribute
    - DescribeInstanceCreditSpecifications
    - DescribeInstanceStatus
    - DescribeInstances
    - DescribeInternetGateways
    - DescribeKeyPairs
    - DescribeLaunchTemplateVersions
    - DescribeLaunchTemplates
    - DescribeMovingAddresses
    - DescribeNatGateways
    - DescribeNetworkAcls
    - DescribeNetworkInterfaceAttribute
    - DescribeNetworkInterfacePermissions
    - DescribeNetworkInterfaces
    - DescribePlacementGroups
    - DescribePrefixLists
    - DescribePrincipalIdFormat
    - DescribePublicIpv4Pools
    - DescribeRegions
    - DescribeReservedInstances
    - DescribeReservedInstancesListings
    - DescribeReservedInstancesModifications
    - DescribeReservedInstancesOfferings
    - DescribeRouteTables
    - DescribeScheduledInstanceAvailability
    - DescribeScheduledInstances
    - DescribeSecurityGroupReferences
    - DescribeSecurityGroups
    - DescribeSnapshotAttribute
    - DescribeSnapshots
    - DescribeSpotDatafeedSubscription
    - DescribeSpotFleetInstances
    - DescribeSpotFleetRequestHistory
    - DescribeSpotFleetRequests
    - DescribeSpotInstanceRequests
    - DescribeSpotPriceHistory
    - DescribeStaleSecurityGroups
    - DescribeSubnets
  transcribe:
    - StartTranscriptionJob
    - GetTranscriptionJob
    - DeleteTranscriptionJob
  states:
    - ListStateMachines
    - ListActivities
    - DescribeStateMachine
    - StartExecution
    - ListExecutions
    - DescribeExecution
    - DescribeStateMachineForExecution
    - GetExecutionHistory
    - StopExecution
    - DescribeActivity
    - GetActivityTask
    - SendTaskSuccess
    - SendTaskFailure
    - SendTaskHeartbeat
  xray:
    - PutTraceSegments
    - PutTelemetryRecords
    - GetSamplingRules
    - GetSamplingTargets
    - GetSamplingStatisticSummaries

plugins:
  - serverless-offline
  - serverless-offline-sqs
  - serverless-dynamodb-local
  - serverless-offline-dynamodb-streams
  - serverless-webpack
  - serverless-appsync-plugin
  - serverless-step-functions
  - serverless-plugin-warmup
  - serverless-plugin-typescript
  - serverless-plugin-canary-deployments
  - serverless-mocha-plugin
  - serverless-kms-secrets
  - serverless-iam-roles-per-function
  - serverless-plugin-log-subscription
  - serverless-apigateway-service-proxy
  - serverless-s3-sync
  - serverless-plugin-aws-alerts
  - serverless-plugin-cloudwatch-dashboard
  - serverless-apigw-binary
  - '@silvermine/serverless-plugin-cloudfront-lambda-edge'
  - serverless-nested-stack
  - serverless-plugin-split-stacks
  - serverless-pseudo-parameters
  - serverless-cloudfront-invalidate
  - serverless-dependson-plugin

arnTemplate:
  - AWS::Lambda::Function: "arn:aws:lambda:{region}:{account-id}:function:{resourceName}"
  - AWS::S3::Bucket: "arn:aws:s3:::{resourceName}"
  - AWS::IAM::Role: "arn:aws:iam::{account-id}:role/{resourceName}"
  - AWS::DynamoDB::Table: "arn:aws:dynamodb:{region}:{account-id}:table/{resourceName}"
  - AWS::Kinesis::Stream: "arn:aws:kinesis:{region}:{account-id}:stream/{resourceName}"
  - AWS::SQS::Queue: "arn:aws:sqs:{region}:{account-id}:{resourceName}"
  - AWS::SNS::Topic: "arn:aws:sns:{region}:{account-id}:{resourceName}"
  - AWS::Events::Rule: "arn:aws:events:{region}:{account-id}:rule/{resourceName}"
  - AWS::ApiGateway::RestApi: "arn:aws:execute-api:{region}:{account-id}:{resourceName}"
  - AWS::ApiGatewayV2::Api: "arn:aws:execute-api:{region}:{account-id}:{resourceName}"
  - AWS::ApiGateway::Endpoint: "https://{resourceName}.execute-api.{region}.amazonaws.com"
  - AWS::StepFunctions::StateMachine: "arn:aws:states:{region}:{account-id}:stateMachine:{resourceName}"
  - AWS::ElastiCache::CacheCluster: "arn:aws:elasticache:{region}:{account-id}:cluster:{resourceName}"
  - AWS::DAX::Cluster: "arn:aws:dax:{region}:{account-id}:cache/{resourceName}"
  - AWS::RDS::DBInstance: "arn:aws:rds:{region}:{accountid}:db:{resourceName}"
  - AWS::Logs::LogGroup: "arn:aws:logs:{region}:{account-id}:log-group:{resourceName}:*"
  - AWS::CloudFront::Distribution: "arn:aws:cloudfront::{account-id}:distribution/{resourceName}"
  
assetTypes:
  - AWS::Lambda::Function
  - AWS::S3::Bucket
  - AWS::IAM::Role
  - AWS::DynamoDB::Table
  - AWS::Kinesis::Stream
  - AWS::SQS::Queue
  - AWS::SNS::Topic
  - AWS::Events::Rule
  - AWS::ApiGateway::RestApi
  - AWS::ApiGatewayV2::Api
  - AWS::StepFunctions::StateMachine
  - AWS::ElastiCache::CacheCluster
  - AWS::DAX::Cluster
  - AWS::RDS::DBInstance
  - AWS::CloudFront::Distribution
  - AWS::Logs::LogGroup

iamManagedPolicies:
  - arn:aws:iam::aws:policy/AWSLambdaExecute
  - arn:aws:iam::aws:policy/AWSLambdaReadOnlyAccess
  - arn:aws:iam::aws:policy/AWSLambdaInvocation-DynamoDB
  - arn:aws:iam::aws:policy/AWSLambdaFullAccess
  - arn:aws:iam::aws:policy/AmazonTranscribeFullAccess
  - arn:aws:iam::aws:policy/AWSXRayDaemonWriteAccess
  - arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
  - arn:aws:iam::aws:policy/service-role/AWSLambdaVPCAccessExecutionRole

assetCatalogMap: # arn.split(':')[2] -> assetType in Jazz Catalog
  - iam: iam_role
  - kinesis: kinesis_stream
  - lambda: lambda
  - apigateway: apigateway
  - cloudfront: cloudfront
  - events: cloudwatch_event
  - s3: s3
  - dynamodb: dynamodb
  - swagger_url: swagger_url
  - endpoint_url: endpoint_url
  - dynamodb_stream: dynamodb_stream
  - sqs: sqs
  - sns: sns
  - apigee_proxy: apigee_proxy
  - execute-api: apigateway
  - states: step-functions
  - rds: rds
  - dax: dynamodb_accelerator
  - elasticache: elasticache
  - logs: log_group

commonExcludes:
  - .git/**
  - .travis.yml
  - .pytest_cache/**
  - pkg/**
  - .gitignore
  - .gitconfig
  - .editorconfig
  - .eslintignore
  - .eslintrc
  - .npmrc
  - .npmignore
  - .jshintrc
  - coverage/**
  - .nyc_output/**
  - docs/**
  - test/**
  - sonar/**
  - .scannerwork/**
  - _config/**
  - events/**
  - _java/**
  - '*circle.yml'
  - '*travis.yml'
  - '*.md'
  - '*.log'
  - '*.txt'
  - 'deployment-env.yml'
  - node_modules/**/aws-sdk/**
  - node_modules/**/*.md
  - node_modules/**/*.markdown
  - node_modules/**/*Makefile
  - node_modules/**/Dockerfile
  - node_modules/**/*.txt
  - node_modules/**/*.yml
  - node_modules/**/*.html
  - node_modules/**/test/**
  - node_modules/**/docs/**
  - node_modules/**/examples/**
  - node_modules/**/bower.json
  - node_modules/**/karma.conf.js
  - node_modules/**/Gruntfile.js
  - node_modules/**/*.gif
  - node_modules/**/*.png
  - node_modules/**/*.jpg
  - node_modules/**/*.jpeg
