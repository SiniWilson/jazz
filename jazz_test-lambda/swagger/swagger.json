{
  "swagger": "2.0",
  "info": {
    "version": "2017-01-30T23:30:18Z",
    "title": "test-lambda",
    "description": "API specification for Test lambda API "
  },
  "host": "dev-cloud-api.corporate.t-mobile.com",
  "basePath": "/jazz",
  "schemes": [
    "https"
  ],
  "paths": {
    "/test-lambda": {
      "options": {
        "description": "CORS Support",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "tags": [
          "CORS"
        ],
        "responses": {
          "200": {
            "description": "Default response for CORS method",
            "headers": {
              "Access-Control-Allow-Headers": {
                "type": "string"
              },
              "Access-Control-Allow-Methods": {
                "type": "string"
              },
              "Access-Control-Allow-Origin": {
                "type": "string"
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "schema": {
              "$ref": "#/definitions/400ErrorResponse"
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/401ErrorResponse"
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "$ref": "#/definitions/403ErrorResponse"
            }
          },
          "404": {
            "description": "Not Found",
            "schema": {
              "$ref": "#/definitions/404ErrorResponse"
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/500ErrorResponse"
            }
          },
          "503": {
            "description": "Service Unavailable",
            "schema": {
              "$ref": "#/definitions/503ErrorResponse"
            }
          }
        },
        "x-amazon-apigateway-integration": {
          "type": "mock",
          "requestTemplates": {
            "application/json": "{\"statusCode\" : 200}"
          },
          "responses": {
            "default": {
              "statusCode": "200",
              "responseTemplates": {
                "application/json": "$input.json('$')"
              },
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,Jazz-Service-ID'",
                "method.response.header.Access-Control-Allow-Methods": "'GET,POST,PUT,DELETE,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          }
        }
      },
      "post": {
        "description": "Post method swagger for Test Lambda",
        "parameters": [{
          "name": "param",
          "in": "body",
          "description": "post body parameter.",
          "required": true,
          "schema": {
            "$ref": "#/definitions/InputObj"
          }
        }, {
          "name": "Jazz-Service-ID",
          "in": "header",
          "required": true,
          "type": "string"
        }],
        "consumes": [
          "application/json",
          "application/x-www-form-urlencoded"
        ],
        "produces": [
          "application/json",
          "application/x-www-form-urlencoded"
        ],
        "responses": {
          "200": {
            "description": "Successful Execution",
            "schema": {
              "$ref": "#/definitions/200SuccessResponse"
            },
            "headers": {
              "Access-Control-Allow-Headers": {
                "type": "string"
              },
              "Access-Control-Allow-Methods": {
                "type": "string"
              },
              "Access-Control-Allow-Origin": {
                "type": "string"
              }
            }
          },
          "400": {
            "description": "Bad Request",
            "schema": {
              "$ref": "#/definitions/400ErrorResponse"
            },
            "headers": {
              "Access-Control-Allow-Headers": {
                "type": "string"
              },
              "Access-Control-Allow-Methods": {
                "type": "string"
              },
              "Access-Control-Allow-Origin": {
                "type": "string"
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/401ErrorResponse"
            },
            "headers": {
              "Access-Control-Allow-Headers": {
                "type": "string"
              },
              "Access-Control-Allow-Methods": {
                "type": "string"
              },
              "Access-Control-Allow-Origin": {
                "type": "string"
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "$ref": "#/definitions/403ErrorResponse"
            },
            "headers": {
              "Access-Control-Allow-Headers": {
                "type": "string"
              },
              "Access-Control-Allow-Methods": {
                "type": "string"
              },
              "Access-Control-Allow-Origin": {
                "type": "string"
              }
            }
          },
          "404": {
            "description": "Not Found",
            "schema": {
              "$ref": "#/definitions/404ErrorResponse"
            },
            "headers": {
              "Access-Control-Allow-Headers": {
                "type": "string"
              },
              "Access-Control-Allow-Methods": {
                "type": "string"
              },
              "Access-Control-Allow-Origin": {
                "type": "string"
              }
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/500ErrorResponse"
            },
            "headers": {
              "Access-Control-Allow-Headers": {
                "type": "string"
              },
              "Access-Control-Allow-Methods": {
                "type": "string"
              },
              "Access-Control-Allow-Origin": {
                "type": "string"
              }
            }
          },
          "503": {
            "description": "Service Unavailable",
            "schema": {
              "$ref": "#/definitions/503ErrorResponse"
            },
            "headers": {
              "Access-Control-Allow-Headers": {
                "type": "string"
              },
              "Access-Control-Allow-Methods": {
                "type": "string"
              },
              "Access-Control-Allow-Origin": {
                "type": "string"
              }
            }
          }
        },
        "x-amazon-apigateway-integration": {
          "type": "aws",
          "uri": "arn:aws:apigateway:{conf-region}:lambda:path/2015-03-31/functions/arn:aws:lambda:{conf-region}:{conf-accId}:function:{lambda_function_name}/invocations",
          "httpMethod": "POST",
          "credentials": "{conf-role}",
          "requestTemplates": {
            "application/json": "\n#define( $loop )\n  {\n  #foreach($key in $map.keySet())\n      \"$util.escapeJavaScript($key)\":\n        \"$util.escapeJavaScript($map.get($key))\"\n        #if( $foreach.hasNext ) , #end\n  #end\n  }\n#end\n\n{\n  \"body\": $input.json(\"$\"),\n  \"method\": \"$context.httpMethod\",\n  \"principalId\": \"$context.authorizer.principalId\",\n  \"stage\": \"$context.stage\",\n  \"resourcePath\" : \"$context.resourcePath\",\n\n  #set( $map = $input.params().header )\n  \"headers\": $loop,\n\n  #set( $map = $input.params().querystring )\n  \"query\": $loop,\n\n  #set( $map = $input.params().path )\n  \"path\": $loop,\n\n  #set( $map = $context.identity )\n  \"identity\": $loop,\n\n  #set( $map = $stageVariables )\n  \"stageVariables\": $loop\n}",
            "application/x-www-form-urlencoded": "\n#define( $body )\n  {\n  #foreach( $token in $input.path('$').split('&') )\n    #set( $keyVal = $token.split('=') )\n    #set( $keyValSize = $keyVal.size() )\n    #if( $keyValSize >= 1 )\n      #set( $key = $util.urlDecode($keyVal[0]) )\n      #if( $keyValSize >= 2 )\n        #set( $val = $util.urlDecode($keyVal[1]) )\n      #else\n        #set( $val = '' )\n      #end\n      \"$key\": \"$val\"#if($foreach.hasNext),#end\n    #end\n  #end\n  }\n#end\n\n#define( $loop )\n  {\n  #foreach($key in $map.keySet())\n      \"$util.escapeJavaScript($key)\":\n        \"$util.escapeJavaScript($map.get($key))\"\n        #if( $foreach.hasNext ) , #end\n  #end\n  }\n#end\n\n{\n  \"body\": $body,\n \"method\": \"$context.httpMethod\",\n  \"principalId\": \"$context.authorizer.principalId\",\n  \"stage\": \"$context.stage\",\n  \"resourcePath\" : \"$context.resourcePath\",\n\n  #set( $map = $input.params().header )\n  \"headers\": $loop,\n\n  #set( $map = $input.params().querystring )\n  \"query\": $loop,\n\n  #set( $map = $input.params().path )\n  \"path\": $loop,\n\n  #set( $map = $context.identity )\n  \"identity\": $loop,\n  \n  #set( $map = $stageVariables )\n  \"stageVariables\": $loop\n}"
          },
          "responses": {
            ".*Process exited before completing request.*": {
              "statusCode": "503",
              "responseTemplates": {
                "application/json": "{\n  \"errorType\":\"ServiceUnavailable\",\n  \"message\": \"Unknown internal error occurred\"\n}\n"
              },
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,Jazz-Service-ID'",
                "method.response.header.Access-Control-Allow-Methods": "'*'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            },
            ".*\"InternalServerError\".*": {
              "statusCode": "500",
              "responseTemplates": {
                "application/json": "$input.path('$.errorMessage')"
              },
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,Jazz-Service-ID'",
                "method.response.header.Access-Control-Allow-Methods": "'*'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            },
            ".*\"BadRequest\".*": {
              "statusCode": "400",
              "responseTemplates": {
                "application/json": "$input.path('$.errorMessage')"
              },
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,Jazz-Service-ID'",
                "method.response.header.Access-Control-Allow-Methods": "'*'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            },
            "default": {
              "statusCode": "200",
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,Jazz-Service-ID'",
                "method.response.header.Access-Control-Allow-Methods": "'*'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            },
            ".*\"Unauthorized\".*": {
              "statusCode": "401",
              "responseTemplates": {
                "application/json": "$input.path('$.errorMessage')"
              },
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,Jazz-Service-ID'",
                "method.response.header.Access-Control-Allow-Methods": "'*'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            },
            ".*\"Forbidden\".*": {
              "statusCode": "403",
              "responseTemplates": {
                "application/json": "$input.path('$.errorMessage')"
              },
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,Jazz-Service-ID'",
                "method.response.header.Access-Control-Allow-Methods": "'*'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            },
            ".*\"NotFound\".*": {
              "statusCode": "404",
              "responseTemplates": {
                "application/json": "$input.path('$.errorMessage')"
              },
              "responseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,Jazz-Service-ID'",
                "method.response.header.Access-Control-Allow-Methods": "'*'",
                "method.response.header.Access-Control-Allow-Origin": "'*'"
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "200SuccessResponse": {
      "type": "object",
      "properties": {
        "data": {
          "$ref": "#/definitions/OutputObj"
        },
        "input": {
          "$ref": "#/definitions/InputObj"
        }
      },
      "title": "Success Response"
    },
    "400ErrorResponse": {
      "type": "object",
      "properties": {
        "error_type": {
          "type": "string",
          "default": "Bad Request format"
        },
        "message": {
          "type": "string"
        }
      }
    },
    "401ErrorResponse": {
      "type": "object",
      "properties": {
        "errorType": {
          "type": "string",
          "default": "Unauthorized"
        },
        "message": {
          "type": "string"
        }
      }
    },
    "403ErrorResponse": {
      "type": "object",
      "properties": {
        "errorType": {
          "type": "string",
          "default": "Forbidden"
        },
        "message": {
          "type": "string"
        }
      }
    },
    "404ErrorResponse": {
      "type": "object",
      "properties": {
        "error_type": {
          "type": "string",
          "default": "Resource Not Found"
        },
        "message": {
          "type": "string"
        }
      }
    },
    "500ErrorResponse": {
      "type": "object",
      "properties": {
        "error_type": {
          "type": "string",
          "default": "Internal Server Error"
        },
        "message": {
          "type": "string"
        }
      }
    },
    "503ErrorResponse": {
      "type": "object",
      "properties": {
        "error_type": {
          "type": "string",
          "default": "Service Unavailable"
        },
        "message": {
          "type": "string"
        }
      }
    },
    "InputObj": {
      "type": "object",
      "properties": {
        "functionARN": {
          "type": "string",
          "description": "Function's ARN For the lambda to be tested"
        },
        "inputJSON": {
          "type": "object",
          "description": "Json Object to be passed to the lambda"
        }
      }
    },
    "OutputObj": {
      "type": "object",
      "properties": {
        "execStatus": {
          "enum": [
            "Success",
            "HandledError",
            "UnhandledError",
            "FunctionInvocationError"
          ],
          "type": "string",
          "description": "Execution status of the lambda invocation"
        },
        "payload": {
          "type": "object",
          "description": "Response from the the lambda to be tested"
        }
      }
    }
  }
}